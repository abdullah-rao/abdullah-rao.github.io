{"componentChunkName":"component---src-templates-blog-post-js","path":"/mongodb/","result":{"data":{"site":{"siteMetadata":{"title":"Abdullah Rao","author":"Abdullah Rao"}},"markdownRemark":{"id":"9c676bf2-8215-517e-aedd-fd726ebc859d","excerpt":"application  input , ,  data injestion , ,  auth , ,  server , html , ,  database  how to integrate authentication with jwt: authentication with bcrypt hashâ€¦","html":"<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>application</td>\n<td><code class=\"language-text\">contact book</code></td>\n</tr>\n<tr>\n<td>input</td>\n<td><code class=\"language-text\">xml</code>, <code class=\"language-text\">xlsx</code>, <code class=\"language-text\">csv</code></td>\n</tr>\n<tr>\n<td>data injestion</td>\n<td><code class=\"language-text\">jq</code>, <code class=\"language-text\">cheerio</code>, <code class=\"language-text\">mongodb compass</code></td>\n</tr>\n<tr>\n<td>auth</td>\n<td><code class=\"language-text\">jwt</code>, <code class=\"language-text\">passport</code>, <code class=\"language-text\">google developer tools</code></td>\n</tr>\n<tr>\n<td>server</td>\n<td><code class=\"language-text\">express js</code>,</td>\n</tr>\n<tr>\n<td>html</td>\n<td><code class=\"language-text\">bootstrap</code>, <code class=\"language-text\">handlebars</code>, <code class=\"language-text\">jquery</code></td>\n</tr>\n<tr>\n<td>database</td>\n<td><code class=\"language-text\">mongodb</code></td>\n</tr>\n</tbody>\n</table>\n<p>how to integrate authentication with jwt:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">const passport = require(&#39;passport&#39;);\nconst localStrategy = require(&#39;passport-local&#39;).Strategy;\nconst UserModel = require(&#39;../model/model&#39;);\n\npassport.use(\n  &#39;signup&#39;,\n  new localStrategy(\n    {\n      usernameField: &#39;email&#39;,\n      passwordField: &#39;password&#39;\n    },\n    async (email, password, done) =&gt; {\n      try {\n        const user = await UserModel.create({ email, password });\n\n        return done(null, user);\n      } catch (error) {\n        done(error);\n      }\n    }\n  )\n);\n\npassport.use(\n  &#39;login&#39;,\n  new localStrategy(\n    {\n      usernameField: &#39;email&#39;,\n      passwordField: &#39;password&#39;\n    },\n    async (email, password, done) =&gt; {\n      try {\n        const user = await UserModel.findOne({ email });\n\n        if (!user) {\n          return done(null, false, { message: &#39;User not found&#39; });\n        }\n\n        const validate = await user.isValidPassword(password);\n\n        if (!validate) {\n          return done(null, false, { message: &#39;Wrong Password&#39; });\n        }\n\n        return done(null, user, { message: &#39;Logged in Successfully&#39; });\n      } catch (error) {\n        return done(error);\n      }\n    }\n  )\n);\n\n\n\nconst JWTstrategy = require(&#39;passport-jwt&#39;).Strategy;\nconst ExtractJWT = require(&#39;passport-jwt&#39;).ExtractJwt;\n\npassport.use(\n  new JWTstrategy(\n    {\n      secretOrKey: &#39;TOP_SECRET&#39;,\n      jwtFromRequest: ExtractJWT.fromUrlQueryParameter(&#39;secret_token&#39;)\n    },\n    async (token, done) =&gt; {\n      try {\n        return done(null, token.user);\n      } catch (error) {\n        done(error);\n      }\n    }\n  )\n);\n\n\n\nconst express = require(&#39;express&#39;);\nconst passport = require(&#39;passport&#39;);\nconst jwt = require(&#39;jsonwebtoken&#39;);\n\nconst router = express.Router();\nrouter.post(\n  &#39;/signup&#39;,\n  passport.authenticate(&#39;signup&#39;, { session: false }),\n  async (req, res, next) =&gt; {\n    res.json({\n      message: &#39;Signup successful&#39;,\n      user: req.user\n    });\n  }\n);\n\nrouter.post(\n  &#39;/login&#39;,\n  async (req, res, next) =&gt; {\n    passport.authenticate(\n      &#39;login&#39;,\n      async (err, user, info) =&gt; {\n        try {\n          if (err || !user) {\n            const error = new Error(&#39;An error occurred.&#39;);\n\n            return next(error);\n          }\n\n          req.login(\n            user,\n            { session: false },\n            async (error) =&gt; {\n              if (error) return next(error);\n\n              const body = { _id: user._id, email: user.email };\n              const token = jwt.sign({ user: body }, &#39;TOP_SECRET&#39;);\n\n              return res.json({ token });\n            }\n          );\n        } catch (error) {\n          return next(error);\n        }\n      }\n    )(req, res, next);\n  }\n);\n\n\nmodule.exports = router;\n\n\n\n// test\nrouter.get(\n  &#39;/profile&#39;,\n  (req, res, next) =&gt; {\n    res.json({\n      message: &#39;You made it to the secure route&#39;,\n      user: req.user,\n      token: req.query.secret_token\n    })\n  }\n);</code></pre></div>\n<p>authentication with bcrypt hash salt:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">const mongoose = require(&#39;mongoose&#39;);\nconst bcrypt = require(&#39;bcrypt&#39;);\n\nconst Schema = mongoose.Schema;\n\nconst UserSchema = new Schema({\n  email: {\n    type: String,\n    required: true,\n    unique: true\n  },\n  password: {\n    type: String,\n    required: true\n  }\n});\n\nUserSchema.pre(\n  &#39;save&#39;,\n  async function(next) {\n    const user = this;\n    const hash = await bcrypt.hash(this.password, 10);\n\n    this.password = hash;\n    next();\n  }\n);\n\nUserSchema.methods.isValidPassword = async function(password) {\n  const user = this;\n  const compare = await bcrypt.compare(password, user.password);\n\n  return compare;\n}\n\nconst UserModel = mongoose.model(&#39;user&#39;, UserSchema);\n\nmodule.exports = UserModel;\n\n\nor\n\n\n//lds mdl\n\nconst User = mongoose.model(&#39;users&#39;);\n\nmodule.exports = function (passport){\n    passport.use(new LocalStrategy({usernameField:&#39;email&#39;}, (email, password, done) =&gt; {\n        console.log(password);\n    }));\n}// module.exports = function (passport){\n//     passport.use(new LocalStrategy({usernameField:&#39;email&#39;}, (email, password, done) =&gt; {\n//         console.log(email);\n//     }));\n// }</code></pre></div>\n<p>Data model</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">const mongoose = require(&#39;mongoose&#39;);\nconst Schema = mongoose.Schema;\n\nconst ContactSchema = new Schema({\n    cname: {\n        type: String,\n        required: true\n    },\n\n    ctitle: {\n        type: String,\n        required: true\n    },\n\n    clastname:{\n        type: String,\n        required: true\n    },\n    \n    cfname: {\n        type: String,\n        required: true\n    },\n    \n    cphone: {\n        type: String,\n        required: true\n    },\n    cappdate : {\n        type: String,\n        required: true\n    },\n    \n    cemail: {\n        type: String,\n        required: true\n    },\n\n    date: {\n        type: Date,\n        default: Date.now\n    }, \n    createdAt: { type: Date, default: Date.now },\n    author: {\n        id: {\n            type: mongoose.Schema.ObjectId,   ref: &quot;user&quot;\n        },\n        username: String\n    },\n    comments:  [{type: mongoose.Schema.ObjectId, ref: &#39;Comment&#39;}],\n    rateAvg: Number,\n    rateCount: Number,\n    hasRated: [\n                {\n                    type: mongoose.Schema.Types.ObjectId,\n                    ref: &quot;user&quot;\n                }\n    ]\n});\n\nmongoose.model(&#39;Contact&#39;, ContactSchema);</code></pre></div>\n<p>css style</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.logo {\n    width: 100%;\n    margin: auto;\n\n}\n\n\n\n\n.card {\n-webkit-box-shadow: 2px 2px 2px 0px #000000; \nbox-shadow: 3px 3px 3px 0px #000000;\n}\n\n.table {\nbackground: #B1D3FF;\nbackground: -moz-linear-gradient(top, #B1D3FF 0%, #A4D4FF 0%, #4FBFEC 100%);\nbackground: -webkit-linear-gradient(top, #B1D3FF 0%, #A4D4FF 0%, #4FBFEC 100%);\nbackground: linear-gradient(to bottom, #B1D3FF 0%, #A4D4FF 0%, #4FBFEC 100%);\nfont-family: &quot;Times New Roman&quot;, Times, serif;\nfont-size: 12px;\nletter-spacing: 0px;\nword-spacing: 2px;\ncolor: #000000;\nfont-weight: normal;\ntext-decoration: none;\nfont-style: normal;\nfont-variant: normal;\ntext-transform: none;\n\n}\n\n.btn {\ncolor: black;\nbackground: #5089BC;\nbackground: -moz-linear-gradient(top, #5089BC 0%, #FFFFFF 0%, #ECECEC 100%);\nbackground: -webkit-linear-gradient(top, #5089BC 0%, #FFFFFF 0%, #ECECEC 100%);\nbackground: linear-gradient(to bottom, #5089BC 0%, #FFFFFF 0%, #ECECEC 100%);\n}</code></pre></div>\n<p>Routing requests for contacts</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">const express = require(&#39;express&#39;);\nconst mongoose = require(&#39;mongoose&#39;);\nconst router = express.Router();\n\n\n\n// load idea model\n\nrequire(&#39;../models/Contact&#39;);\nconst Contact = mongoose.model(&#39;Contact&#39;);\nrequire(&#39;../models/Comment&#39;);\nconst Comment = mongoose.model(&#39;Comment&#39;);\n\nrouter.get(&#39;/&#39;, (req, res) =&gt; {\n    Contact.find({}).lean()\n        .sort({date: &#39;desc&#39;})\n        .then(contacts =&gt; {\n            res.render(&#39;contacts/index&#39;, {\n                contacts:contacts //pass 2 tmplt\n            });\n        });\n});\n\n//\nrouter.post(&#39;/&#39;, (req, res) =&gt; {\n    console.log(req.body.cname);\n\n    let errors = [];\n    if(!req.body.cname){\n        errors.push({text: &#39;Please add a contact name&#39;});\n    }\n\n    if(errors.length &gt; 0){\n        res.render(&#39;contacts/add&#39;,{\n            errors: errors,\n            title: req.body.title,\n            details: req.body.details\n        });\n    } else {\n        // res.send(&#39;passed&#39;);\n        const newContact = {\n            cname: req.body.cname,\n            ctitle: req.body.ctitle,\n            clastname: req.body.clastname,\n            cfname: req.body.cfname,\n            cphone: req.body.cphone,\n            cappdate: req.body.cappdate,\n            cemail: req.body.cemail,\n            date:  Date.now()\n        }\n        new Contact(newContact)\n            .save()\n            .then(contact =&gt; {\n                res.redirect(&#39;/contacts&#39;)\n            })\n    }\n});\n\n\n\n\nrouter.get(&#39;/add&#39;, (req, res) =&gt; {\n    res.render(&#39;contacts/add&#39;);\n});\n\n// retrieve single\nrouter.get(&#39;/edit/:id&#39;, (req,res) =&gt; {\n\n    Contact.findOne({\n        _id: req.params.id \n    })\n    .lean()\n\n    \n\n    .then(contact =&gt; {\n        console.log(contact)\n        res.render(&#39;contacts/edit&#39;, {\n            contact: contact\n        }); \n    });\n});\n\n// edit single\nrouter.put(&#39;/:id&#39;, (req,res) =&gt; {\n    console.log(req.params);\n    Contact.findOne({\n        _id: req.params.id \n    })\n    .then(contact =&gt; {\n        // new vals\n        contact.cname = req.body.cname;\n        contact.ctitle = req.body.ctitle;\n        contact.clastname = req.body.clastname;\n        contact.cfname = req.body.cfname;\n        contact.cphone = req.body.cphone;\n        contact.cappdate = req.body.cappdate;\n        contact.cemail = req.body.cemail;\n        var comment = new Comment({name: &#39;Wrench&#39;, price: 5});\n        comment.save()\n        contact.comments.push(comment)\n\n        contact.save()\n            .then(contact =&gt; {\n                req.flash(&#39;success_msg&#39;, &#39;Contact was successfully updated to cpdatabase&#39;);\n                res.redirect(&#39;/contacts&#39;);\n            })\n    })\n})\n\n\nrouter.delete(&#39;/:id&#39;, (req, res) =&gt; {\n    Contact.remove({_id: req.params.id})\n        .then(() =&gt; {\n            req.flash(&#39;success_msg&#39;, &#39;Contact was removed from cpdatabase&#39;);\n            res.redirect(&#39;/contacts&#39;);\n        });\n});\nmodule.exports = router;</code></pre></div>\n<p>accessing attributes with embedded js</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;div class=&quot;card p-3 mb-2 bg-info text-light bg-dark&quot;&gt;\n  &lt;div class=&quot;card-header bg-warning text-dark&quot;&gt;\n    show this contact&#39;s info:\n  &lt;/div&gt;\n\n    {{#each errors}}\n        &lt;div class=&quot;alert alert-danger&quot;&gt;{{text}}&lt;/div&gt;\n    {{else}}\n\n    {{/each}}\n\n\n{{contact._id}}\n{{contact.ctitle}}\n{{contact.clastname}}\n{{contact.cfname}}\n{{contact.cname}}\n{{contact.cphone}}\n{{contact.cappdate}}\n{{contact.cemail}}\n{{contact.date}}\n{{contact.createdAt}}</code></pre></div>\n<p>Add via post method</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;div class=&quot;card p-3 mb-2 bg-info text-light bg-dark&quot;&gt;\n  &lt;div class=&quot;card-header&quot;&gt;\n    Add a new contact to CP Database\n  &lt;/div&gt;\n\n    {{#each errors}}\n        &lt;div class=&quot;alert alert-danger&quot;&gt;{{text}}&lt;/div&gt;\n    {{else}}\n\n    {{/each}}\n\n\n  &lt;div class=&quot;card-body&quot;&gt;\n\n&lt;form action=&quot;/contacts&quot; method=&quot;POST&quot;&gt; \n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;cname&quot;&gt;contact name&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;cname&quot; placeholder=&quot;contact full name&quot; required&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;ctitle&quot;&gt;contact title&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;ctitle&quot; placeholder=&quot;Contact designation&quot; required&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;clastname&quot;&gt;contact last name&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;clastname&quot;  required&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;cfname&quot;&gt;contact first name&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;cfname&quot;  required&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;cphone&quot;&gt;contact phone number&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;cphone&quot;  required&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;cappdate&quot;&gt;contact Appointment Date&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;cappdate&quot; placeholder=&quot;DDMMYY1301&quot; required&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;cemail&quot;&gt;contact email&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;cemail&quot; placeholder=&quot;contact full name&quot; required&gt;\n    &lt;/div&gt;\n\n    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary btn-lg btn-block&quot;&gt;Submit&lt;/button&gt;\n&lt;/form&gt;\n\n  &lt;/div&gt;\n&lt;/div&gt;</code></pre></div>\n<p>Edit via post method with put</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;div class=&quot;card p-3 mb-2 bg-info text-light bg-dark&quot;&gt;\n  &lt;div class=&quot;card-header bg-warning text-dark&quot;&gt;\n    edit this contact&#39;s info:\n  &lt;/div&gt;\n\n    {{#each errors}}\n        &lt;div class=&quot;alert alert-danger&quot;&gt;{{text}}&lt;/div&gt;\n    {{else}}\n\n    {{/each}}\n\n{{!-- \n{{contact._id}}\n{{contact.ctitle}}\n{{contact.clastname}}\n{{contact.cfname}}\n{{contact.cname}}\n{{contact.cphone}}\n{{contact.cappdate}}\n{{contact.cemail}}\n{{contact.date}}\n{{contact.createdAt}} --}}\n\n  &lt;div class=&quot;card-body&quot;&gt;\n \n&lt;form action=&quot;/contacts/{{contact._id}}?_method=PUT&quot; method=&quot;POST&quot;&gt; \n&lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;PUT&quot;&gt; \n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;cname&quot;&gt;contact name&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;cname&quot; placeholder=&quot;contact full name&quot; value=&quot;{{contact.cname}}&quot; required&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;ctitle&quot;&gt;contact title&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;ctitle&quot; placeholder=&quot;Contact designation&quot; value=&quot;{{contact.ctitle}}&quot; required&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;clastname&quot;&gt;contact last name&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;clastname&quot;   value=&quot;{{contact.clastname}}&quot; required&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;cfname&quot;&gt;contact first name&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;cfname&quot;  value=&quot;{{contact.cfname}}&quot; required&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;cphone&quot;&gt;contact phone number&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;cphone&quot;  value=&quot;{{contact.cphone}}&quot; required&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;cappdate&quot;&gt;contact Appointment Date&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;cappdate&quot; placeholder=&quot;DDMMYY1301&quot; value=&quot;{{contact.cappdate}}&quot; required&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;label for=&quot;cemail&quot;&gt;contact email&lt;/label&gt;\n        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;cemail&quot; placeholder=&quot;contact full name&quot; value=&quot;{{contact.cemail}}&quot; required&gt;\n    &lt;/div&gt;\n\n\n    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary btn-lg btn-block&quot;&gt;Submit&lt;/button&gt;\n&lt;/form&gt;\n\n  &lt;/div&gt;\n&lt;/div&gt;</code></pre></div>\n<p>Main Page code</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=&quot;UTF-8&quot;&gt;\n    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css&quot; integrity=&quot;sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm&quot; crossorigin=&quot;anonymous&quot;&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/style.css&quot;&gt;\n\n    &lt;title&gt;CPDatabase&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n{{&gt; _navbar}}\n\n&lt;div class=&quot;container&quot;&gt;\n    {{&gt; _msg}}\n    {{&gt; _errors}}\n    {{{body}}}\n&lt;/div&gt;\n\n&lt;script src=&quot;https://code.jquery.com/jquery-3.2.1.slim.min.js&quot; integrity=&quot;sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;\n&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js&quot; integrity=&quot;sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;\n&lt;script src=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js&quot; integrity=&quot;sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;</code></pre></div>\n<p>Register User</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;div class=&quot;card&quot; &gt;\n  &lt;div class=&quot;card-body&quot;&gt;\n    &lt;h5 class=&quot;card-title&quot;&gt;Register new user for CPDatabase&lt;/h5&gt;\n&lt;form action=&quot;/users/register&quot; method=&quot;post&quot;&gt;\n  &lt;div class=&quot;form-row&quot;&gt;\n    &lt;div class=&quot;form-group col-md-6&quot;&gt;\n      &lt;label for=&quot;name&quot;&gt;User Name:&lt;/label&gt;\n      &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;name&quot; value=&quot;{{name}}&quot; placeholder=&quot;Name&quot; required&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group col-md-6&quot;&gt; \n      &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;\n      &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;password&quot; placeholder=&quot;password&quot; value={{password}} required&gt;\n    &lt;/div&gt;\n        &lt;div class=&quot;form-group col-md-6&quot;&gt;\n      &lt;label for=&quot;password2&quot;&gt;Confirm Password:&lt;/label&gt;\n      &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;password2&quot; placeholder=&quot;password2&quot; value={{password2}} required&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n  &lt;div class=&quot;form-group&quot;&gt;\n    &lt;label for=&quot;inputAddress&quot;&gt;email address:&lt;/label&gt;\n    &lt;input type=&quot;email&quot; class=&quot;form-control&quot; id=&quot;email&quot; name=&quot;email&quot; placeholder=&quot;&quot; value={{email}} required&gt;\n  &lt;/div&gt;\n\n  &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Register this user&lt;/button&gt;\n&lt;/form&gt;\n  &lt;/div&gt;\n&lt;/div&gt;\n  \n       \n      </code></pre></div>\n<p>Login user</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;div class=&quot;card&quot; &gt;\n  &lt;div class=&quot;card-body&quot;&gt;\n    &lt;h5 class=&quot;card-title&quot;&gt;CPDatabase Login&lt;/h5&gt;\n    &lt;h6 class=&quot;card-subtitle mb-2 text-muted&quot;&gt;Please ensure passwords match&lt;/h6&gt;\n&lt;form action=&quot;/users/login&quot; method=&quot;post&quot;&gt;\n  &lt;div class=&quot;form-row&quot;&gt;\n\n\n  &lt;/div&gt;\n  &lt;div class=&quot;form-group col-md-6&quot;&gt;\n    &lt;label for=&quot;inputAddress&quot;&gt;email address:&lt;/label&gt;\n    &lt;input type=&quot;email&quot; class=&quot;form-control&quot; id=&quot;email&quot; name=&quot;email&quot; placeholder=&quot;&quot; value={{email}} required&gt;\n  &lt;/div&gt;\n\n\n    &lt;div class=&quot;form-group col-md-6&quot;&gt; \n      &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;\n      &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;password&quot; placeholder=&quot;password&quot; value={{password}} required&gt;\n    &lt;/div&gt;\n\n  &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;log in&lt;/button&gt;\n&lt;/form&gt;\n  &lt;/div&gt;\n&lt;/div&gt;</code></pre></div>\n<p>Handle User requests</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">const express = require(&#39;express&#39;);\nconst mongoose = require(&#39;mongoose&#39;);\nconst router = express.Router();\nconst path = require(&#39;path&#39;)\nconst bcrypt = require(&#39;bcryptjs&#39;);\nconst passport  = require(&#39;passport&#39;);\n// path.join(__dirname, &#39;../public/&#39;)      //corret\n\n//ld usr mdl\nrequire(&#39;../models/User&#39;);\nconst User = mongoose.model(&#39;users&#39;);\n\n\nrequire(&#39;../config/passport&#39;)(passport);\n\n\n\nrouter.get(&#39;/login&#39;, (req, res) =&gt; {\n    res.render(&#39;users/login&#39;)\n});\nrouter.post(&#39;/login&#39;, (req, res, next) =&gt; {\n    passport.authenticate(&#39;local&#39;, {\n        successRedirect: &#39;/contacts&#39;, \n        failureRedirect: &#39;/users/login&#39;,\n        failureFlash: true\n    })(req, res, next);\n\n});\n\n\n\n\nrouter.get(&#39;/register&#39;, (req, res) =&gt; {\n    res.render(&#39;users/register&#39;);\n});\n\nrouter.post(&#39;/register&#39;, (req, res) =&gt; {\n//    console.log(req.body);\n    let errors = []; \n\n    if(req.body.password != req.body.password2){\n        errors.push ({text: &#39;passwords dont match&#39;});\n    }\n\n    if (req.body.password.length &lt; 4 ){\n        errors.push({text: &#39;password length error&#39;})\n    }\n\n    if (errors.length &gt; 0) {\n        res.render(&#39;users/register&#39;, {\n            errors: errors,\n            name: req.body.name,\n            email: req.body.email,\n            password: req.body.password,\n            password2: req.body.password2\n        });\n    }\n    else {\n\n        User.findOne({email: req.body.email})\n            .then(user =&gt; {\n                if(user){\n                    req.flash(&#39;error_msg&#39;, &#39;Email is already associated with an account&#39;);\n                    res.redirect(&#39;/users/register&#39;)\n                } else {\n                    const newUser = new User ({\n                        name: req.body.name,\n                        email: req.body.email, \n                        password: req.body.password\n                    })\n                    // console.log(newUser);\n                    bcrypt.genSalt(10, (err, salt) =&gt; {\n                        bcrypt.hash(newUser.password, salt, (err, hash) =&gt; {\n                            if(err) throw err;\n                            newUser.password = hash;\n                            newUser.save()\n                                .then(user =&gt; {\n                                    req.flash(&#39;success_msg&#39;, &#39;you are now registered and can log in&#39;);\n                                    res.redirect(&#39;/users/login&#39;);\n                                })\n                                .catch( err =&gt; {\n                                    console.log(err);\n                                    return;\n                                });\n                        });\n                    });\n                }\n            });\n\n        \n    }\n\n});</code></pre></div>\n<p>Adding info about a specific contact</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// edit single\nrouter.put(&#39;/:id&#39;, (req,res) =&gt; {\n    console.log(req.params);\n    Contact.findOne({\n        _id: req.params.id \n    })\n    .then(contact =&gt; {\n        var comment = new Comment({name: &#39;Wrench&#39;, price: 5});\n        comment.save()\n        contact.comments.push(comment)\n\t//Pushing related comment to a contact (referenced association)\n\n\n\n        contact.save()\n            .then(contact =&gt; {\n                req.flash(&#39;success_msg&#39;, &#39;Contact was successfully updated to cpdatabase&#39;);\n                res.redirect(&#39;/contacts&#39;);\n            })\n    })\n})</code></pre></div>","frontmatter":{"title":"Javascript","date":"February 11, 2021","description":null,"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAACTElEQVQozw3L209SYQAA8LNeeuiy1dbFFVYWcs53O9+5fgcwUJlDBTuAiiKoaOIIbyjDSxlYKgqexNtEa8lsrdrMh3zrv6vf+4+764W2ELb1i/wE9uQVNak99fGPPRDEVDKmymm1Jaf515VgWRo8oNF94soL98OOFynQEAbcTRnCcWRaJLpLg+tSd1FDMdwUxdIb3T2v+QtG5xoLbCqJIyVZk5OnhKYdD8K8LQaeDALuxkt8HUOHCaIVPH6q9JZV7wK1RwT6WnXP6q451rqsBTfViRM9e66O1pCQcNwxBVsC2McQp83ie134GoW3FKCNQ3OL+oqSPsTjYVme1FsW9K4C6y2z4UM2VVdC26Ah4GhOQTmLXCuA66/gthUkZvDzOL7thI98wDmD3IlmZURsW2KBomGuG4k9lv7MMueSnhEehoC0gDzvUNcm5LJfpalTOmSRQJGweUQniWMA04ADBqBniXW+1yNbRnzfmD4zkjVi7+MbRzCYQfoiCpQQt3Wpfvil5OpS8oDELGJukI6i6J3GzX7eV9T6ykaiylI1d7queed4mwnxFFFzpH0N95QxZ/3RN36ri+d0/oxmTsR0jYxWib9AhAjPZunAJyNeNSZPXIO7oj0kCBOid5UGt+mrCg7vQK50qX28UDYulOJPefkbzdel1e/K9BcqjvFgBAVLesxyxo9UIyk09hA1q7Cc7FujoR0xWgXc8V+ndaVbV+r/X/gh5es0dSimjmlrFjVFBLPEIhWjI4+edUCWU7xv1faC3F2i0T0xdoD+Aa6BueeNRhs/AAAAAElFTkSuQmCC","aspectRatio":2.085889570552147,"src":"/static/68ef0bea899ee32a61d1fe6d1587cce8/40a76/query.png","srcSet":"/static/68ef0bea899ee32a61d1fe6d1587cce8/c972b/query.png 340w,\n/static/68ef0bea899ee32a61d1fe6d1587cce8/27625/query.png 680w,\n/static/68ef0bea899ee32a61d1fe6d1587cce8/40a76/query.png 1360w,\n/static/68ef0bea899ee32a61d1fe6d1587cce8/dd99e/query.png 1832w","sizes":"(max-width: 1360px) 100vw, 1360px"}}}}}},"pageContext":{"slug":"/mongodb/","previous":{"fields":{"slug":"/sql/"},"frontmatter":{"title":"sql"}},"next":null}},"staticQueryHashes":["63159454"]}